import { type CMS } from "@lwo/types";
import { Card, Link, PageTitle } from "@lwo/ui/components";
import { getPageData, getPageList } from "@lwo/utils/cms";
import type { Metadata } from "next";
import { pages } from "routes";

export const getData = async (): Promise<{
  pages: CMS.Page[];
}> => {
  try {
    const data = await fetch("http://localhost:1337/api/pages?populate=*");
    const { data: pages } = await data.json();
    return { pages };
  } catch (err) {
    console.error(err);
    return { pages: [] };
  }
};

export const metadata: Metadata = {
  title: "Create Turborepo",
  description: "Generated by create turbo",
};

export default async function Page(props: App.PageProps) {
  // console.log(await props.params);
  // console.log(await props.searchParams);
  const pageList = await getPageList();
  const data = await getPageData(pageList[0]?.slug || "");

  return (
    <>
      <PageTitle>Page title</PageTitle>
      <h1 className="text-blue-200">LWO website</h1>

      <Link href={pages.ABOUT_US.path}>{pages.ABOUT_US.title}</Link>

      <pre>{JSON.stringify(data, null, 2)}</pre>

      <Card>This is shared UI!</Card>
    </>
  );
}
